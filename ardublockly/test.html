
<!DOCTYPE html>
<head>
  
  <!-- Ardublockly - These three files contain the compress version -->
  <!-- <script src="../blockly/blockly_compressed.js"></script> -->
  <!-- <script src="../blockly/blocks_compressed.js"></script> -->
  <!-- <script src="../blockly/arduino_compressed.js"></script> -->
  
  
  <script src="../blockly/blockly_uncompressed.js"></script>
  <script src="../blockly/blocks/logic.js"></script>
  <script src="../blockly/blocks/loops.js"></script>
  <script src="../blockly/blocks/math.js"></script>
  <script src="../blockly/blocks/text.js"></script>
  <script src="../blockly/blocks/lists.js"></script>
  <script src="../blockly/blocks/colour.js"></script>
  <script src="../blockly/blocks/variables.js"></script>
  <script src="../blockly/blocks/procedures.js"></script>
  <script src="../blockly/blocks/arduino/io.js"></script>
  <script src="../blockly/blocks/arduino/map.js"></script>
  <script src="../blockly/blocks/arduino/procedures.js"></script>
  <script src="../blockly/blocks/arduino/serial.js"></script>
  <script src="../blockly/blocks/arduino/servo.js"></script>
  <script src="../blockly/blocks/arduino/spi.js"></script>
  <script src="../blockly/blocks/arduino/stepper.js"></script>
  <script src="../blockly/blocks/arduino/time.js"></script>
  <script src="../blockly/blocks/arduino/tone.js"></script>
  <script src="../blockly/blocks/arduino/variables.js"></script>
  <script src="../blockly/generators/arduino.js"></script>
  <script src="../blockly/generators/arduino/boards.js"></script>
  <script src="../blockly/generators/arduino/io.js"></script>
  <script src="../blockly/generators/arduino/lists.js"></script>
  <script src="../blockly/generators/arduino/logic.js"></script>
  <script src="../blockly/generators/arduino/loops.js"></script>
  <script src="../blockly/generators/arduino/map.js"></script>
  <script src="../blockly/generators/arduino/math.js"></script>
  <script src="../blockly/generators/arduino/procedures.js"></script>
  <script src="../blockly/generators/arduino/serial.js"></script>
  <script src="../blockly/generators/arduino/servo.js"></script>
  <script src="../blockly/generators/arduino/spi.js"></script>
  <script src="../blockly/generators/arduino/stepper.js"></script>
  <script src="../blockly/generators/arduino/text.js"></script>
  <script src="../blockly/generators/arduino/time.js"></script>
  <script src="../blockly/generators/arduino/tone.js"></script>
  <script src="../blockly/generators/arduino/variables.js"></script>


  <!-- Default language js files, user selection appended to head on load -->
  <script src="../blockly/msg/js/en.js"></script>
  <script src="msg/en.js"></script>

  <script src="https://blockly-demo.appspot.com/static/demos/prettify.js"></script>
  <script src="/blockly/blockly-demo/acorn_interpreter.js"></script>

  <link href="https://blockly-demo.appspot.com/static/demos/prettify.css" rel="stylesheet">
  <link rel="stylesheet" href="prettify/arduino.css">


  <script src="ardublockly_toolbox.js"></script>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/codemirror.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/codemirror.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/mode/clike/clike.js"></script>

  <link href="blockly-demo.css" rel="stylesheet">

</head>
<body>
<div class="app-container">
  <div id="blocklyDiv" class="main blockly-panel"></div>
  <div id="" class="main output-panel">
  <textarea id="codeDiv"></textarea>
    <!-- <hr class="POps"> -->
    <pre></pre>
  </div>
</div>



<xml id="ArduBlocklyToolbox">
    <sep></sep>
    <category id="catLogic" name="Logic">
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null"></block>
        <block type="logic_ternary"></block>
    </category>
    <sep></sep>
    <category id="catLoops" name="Loops">
        <block type="controls_repeat_ext">
            <value name="TIMES">
                <block type="math_number">
                    <field name="NUM">10</field>
                </block>
            </value>
        </block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for">
            <value name="FROM">
                <block type="math_number">
                    <field name="NUM">1</field>
                </block>
            </value>
            <value name="TO">
                <block type="math_number">
                    <field name="NUM">10</field>
                </block>
            </value>
            <value name="BY">
                <block type="math_number">
                    <field name="NUM">1</field>
                </block>
            </value>
        </block>
        <block type="controls_flow_statements"></block>
    </category>
    <sep></sep>
    <category id="catMath" name="Math">
        <block type="math_number"></block>
        <block type="math_arithmetic"></block>
        <block type="math_single"></block>
        <block type="math_trig"></block>
        <block type="math_constant"></block>
        <block type="math_number_property"></block>
        <block type="math_change">
            <value name="DELTA">
                <block type="math_number">
                    <field name="NUM">1</field>
                </block>
            </value>
        </block>
        <block type="math_round"></block>
        <block type="math_modulo"></block>
        <block type="math_constrain">
            <value name="LOW">
                <block type="math_number">
                    <field name="NUM">1</field>
                </block>
            </value>
            <value name="HIGH">
                <block type="math_number">
                    <field name="NUM">100</field>
                </block>
            </value>
        </block>
        <block type="math_random_int">
            <value name="FROM">
                <block type="math_number">
                    <field name="NUM">1</field>
                </block>
            </value>
            <value name="TO">
                <block type="math_number">
                    <field name="NUM">100</field>
                </block>
            </value>
        </block>
        <block type="math_random_float"></block>
        <block type="base_map"></block>
    </category>
    <sep></sep>
    <category id="catText" name="Text">
        <block type="text"></block>
        <block type="cocomake_singlechar"></block>
        <block type="text_join"></block>
        <block type="text_append">
            <value name="TEXT">
                <block type="text"></block>
            </value>
        </block>
        <block type="text_length"></block>
        <block type="text_isEmpty"></block>
    </category>
    <sep></sep>
    <category id="catVariables" name="Variables">
        <block type="variables_get"></block>
        <block type="variables_set"></block>
        <block type="variables_set">
            <value name="VALUE">
                <block type="variables_set_type"></block>
            </value>
        </block>
        <block type="variables_set_type"></block>
    </category>
    <sep></sep>
    <category id="catFunctions" name="Functions" custom="PROCEDURE"></category>
    <sep></sep>
    <category id="catInputOutput" name="Input/Output">

  <block type="variables_set">
    <value name="VALUE">
      <block type="io_analogread">
      </block>
    </value>
  </block>

  <block type="variables_set">
    <value name="VALUE">
      <block type="io_digitalread">
      </block>
    </value>
  </block>


        <block type="io_digitalwrite">
            <value name="STATE">
                <block type="io_highlow"></block>
            </value>
        </block>
        <block type="io_digitalread"></block>
        <block type="io_builtin_led">
            <value name="STATE">
                <block type="io_highlow"></block>
            </value>
        </block>
        <block type="io_analogwrite"></block>
        <block type="io_analogread"></block>





        <block type="io_highlow"></block>
        <block type="io_pulsein">
            <value name="PULSETYPE">
                <shadow type="io_highlow"></shadow>
            </value>
        </block>
        <block type="io_pulsetimeout">
            <value name="PULSETYPE">
                <shadow type="io_highlow"></shadow>
            </value>
            <value name="TIMEOUT">
                <block type="math_number"></block>
            </value>
        </block>
    </category>
    <sep></sep>
    <category id="catTime" name="Time">
        <block type="time_delay">
            <value name="DELAY_TIME_MILI">
                <block type="math_number">
                    <field name="NUM">1000</field>
                </block>
            </value>
        </block>
                <block type="coco_interval_function"></block>

        <block type="time_delaymicros">
            <value name="DELAY_TIME_MICRO">
                <block type="math_number">
                    <field name="NUM">100</field>
                </block>
            </value>
        </block>
        <block type="time_millis"></block>
        <block type="time_micros"></block>
        <block type="infinite_loop"></block>
    </category>
    <sep></sep>
    <category id="catAudio" name="Audio">
        <block type="io_tone">
            <field name="TONEPIN">0</field>
            <value name="FREQUENCY">
                <shadow type="math_number">
                    <field name="NUM">220</field>
                </shadow>
            </value>
        </block>
        <block type="io_notone"></block>
    </category>
    <sep></sep>
    <category id="catMotors" name="Motors">
        <block type="servo_write">
            <value name="SERVO_ANGLE">
                <block type="math_number">
                    <field name="NUM">90</field>
                </block>
            </value>
        </block>
        <block type="servo_read"></block>
        <block type="stepper_config">
            <field name="STEPPER_PIN1">1</field>
            <field name="STEPPER_PIN2">2</field>
            <value name="STEPPER_STEPS">
                <block type="math_number">
                    <field name="NUM">100</field>
                </block>
            </value>
            <value name="STEPPER_SPEED">
                <block type="math_number">
                    <field name="NUM">10</field>
                </block>
            </value>
        </block>
        <block type="stepper_step">
            <value name="STEPPER_STEPS">
                <block type="math_number">
                    <field name="NUM">10</field>
                </block>
            </value>
        </block>
    </category>
    <sep></sep>
    <category id="catComms" name="Comms">
        <block type="serial_setup"></block>
        <block type="serial_print"></block>
        <block type="text_prompt_ext">
            <value name="TEXT">
                <block type="text"></block>
            </value>
        </block>
        <block type="spi_setup"></block>
        <block type="spi_transfer"></block>
        <block type="spi_transfer_return"></block>
    </category>
        <sep></sep>
    <category id="catCocoKey" name="CocoKeyboard">
        <block type="cocokey_sendkeystroke">
            <value name="COCOKEY_STROKE">
                <block type="math_number">
                    <field name="NUM">0</field>
                </block>
            </value>
        </block>
                <block type="cocokey_delay">
                              <value name="COCOKEY_DELAY">
                <block type="math_number">
                    <field name="NUM">500</field>
                </block>
            </value>

                </block>
                <block type="cocokey_print">
                              <value name="COCOKEY_PRINT">
                <block type="text"></block>
            </value>

                </block>
                <block type="cocokey_update"></block>

            </category>
            <sep></sep>
    <category id="catCocoMidi" name="CocoMidi">


                <block type="cocomidi_sendnote_var">


                     <value name="COCOMIDI_STATE">
                <block type="cocomidi_note_state">
                </block>
            </value>

                      <value name="COCOMIDI_CHAN">
                <block type="math_number">
                    <field name="NUM">0</field>
                </block>
            </value>
                      <value name="COCOMIDI_VEL">
                <block type="math_number">
                    <field name="NUM">0</field>
                </block>
            </value>


</block>
        <block type="cocomidi_sendcchires">
            <value name="COCOMIDI_VALUE">
                <block type="math_number">
                    <field name="NUM">0</field>
                </block>
            </value>
            <value name="COCOMIDI_CHAN">
                <block type="math_number">
                    <field name="NUM">1</field>
                </block>
            </value>
        </block>

                <block type="cocomidi_sendcchires">
            <value name="COCOMIDI_VALUE">
                <block type="variables_get">
                </block>
            </value>
            <value name="COCOMIDI_CHAN">
               <block type="variables_get">
                </block>
            </value>
        </block>


        <block type="cocomidi_update"></block>
        <block type="cocomidi_note_state"></block>
        <block type="cocomidi_message"></block>        
        <block type="cocomidi_read"></block>

        <block type="cocomidi_delay">

                      <value name="COCOMIDI_DELAY">
                <block type="math_number">
                    <field name="NUM">500</field>
                </block>
            </value>

        </block>


    </category>
            <sep></sep>
    <category id="catCocoMouse" name="CocoMouse">
        <block type="cocokey_update"></block>
    </category>    
            <sep></sep>
    <category id="catCocoTouch" name="CocoTouch">
        <block type="cocotouch_touched"></block>
  <block type="variables_get">
    <field name="VAR">velocityValue</field>
  </block>
  <block type="variables_get">
    <field name="VAR">prevVelocity</field>
  </block>

    <block type="variables_get">
    <field name="VAR">filtered_value</field>
  </block>
    </category>  
</xml>

<script>

// var toolBox =  Blockly.Xml.textToDom(Ardublockly.TOOLBOX_XML);
  var toolBox = document.getElementById('ArduBlocklyToolbox');

  var workspace = Blockly.inject('blocklyDiv',
      {

        toolbox: toolBox,
            grid: {
                spacing: 25,
                length: 3,
                colour: "#ccc",
                snap: !0
            },
            zoom: {
                controls: !0,
                wheel: !1,
                startScale: 1,
                maxScale: 3,
                minScale: .3,
                scaleSpeed: 1.2
            },
            trashcan: !0
      });
  var defaultBlocks = document.getElementById('blocklyDefault');

  var cm = CodeMirror.fromTextArea(document.getElementById("codeDiv"), {
    lineNumbers: true,
    lineWrapping: true,
    mode: "text/x-c++src"
  });


  function myUpdateFunction(event) {
    // var languageDropdown = document.getElementById('languageDropdown');
    // var languageSelection = languageDropdown.options[languageDropdown.selectedIndex].value;
    // var codeDiv = document.getElementById('codeDiv');
    // var codeHolder = document.createElement('pre');
    // codeHolder.className = 'prettyprint but-not-that-pretty';
    // var code = document.createTextNode(Blockly.Arduino.workspaceToCode(workspace));
    // codeHolder.appendChild(code);
    // codeDiv.replaceChild(codeHolder, codeDiv.lastElementChild);

    var doc = cm.getDoc();

    cm.getDoc().setValue(Blockly.Arduino.workspaceToCode(workspace))

    // prettyPrint();
  }

  workspace.addChangeListener(myUpdateFunction);
  
  function executeBlockCode() {
    var code = Blockly.Arduino.workspaceToCode(workspace);
    console.log('play');
  }
  
  document.getElementById('playButton').addEventListener('click', executeBlockCode);
</script>
</body>